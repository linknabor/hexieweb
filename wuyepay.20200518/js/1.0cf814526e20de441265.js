webpackJsonp([1],{A6Ag:function(t,e,a){var s=a("MhFt");"string"==typeof s&&(s=[[t.i,s,""]]),s.locals&&(t.exports=s.locals);a("rjj0")("046baa7f",s,!0)},Aef7:function(t,e,a){"use strict";(function(t){var s,n=a("mvHQ"),o=(a.n(n),a("fxnj")),i=a.n(o);e.a={data:function(){return{typename:"微信支付",disname:"物业费优惠",distname:"停车费优惠",discounts:[],ruleType:"",reductionAmt:"",reducFeePrice:"",is_integral:1,integral:"",payFeeType:this.$route.query.payFeeType,totalPrice:0,bind_switch:this.$route.query.bind_switch,reduceAmt:0,version:this.$route.query.version,reduceM:this.$route.query.reduceMode,cardId:this.$route.query.cardId,orderNo:"",acctNNo:this.$route.query.acctNNo,hasReduce:"0",tdiscount:0,reduceMoney:0,count:0,countmong:0,counttoll:0,captcha:"",yzmtime:60,yzmstr:"获取验证码",showyan:!1,ulist:{},uptonAmount:"未使用",upronAmountNumber:0,uptonData:[],allCoupons:[],couponId:"",selectUpton:!0,sUptop:"No"}},created:function(){s=this},mounted:function(){s.geturl(),s.Coupons(),s.getDiscount()},components:{},methods:{geturl:function(){window.localStorage.getItem("paylist")&&(s.ulist=JSON.parse(window.localStorage.getItem("paylist"))),s.ulist.payType>=1&&(s.typename="银行卡支付("+s.acctNNo.substring(s.acctNNo.length-4)+")"),s.ulist.payType>1?s.showyan=!0:s.showyan=!1},Carandpay:function(t){s.count=t;var e=0,a=0;if("0"!=s.reduceM){if("1"==s.reduceM)a="1",e=Math.round(s.count*a)/a,s.hasReduce="1";else if("2"==s.reduceM)a="10",e=Math.round(s.count*a)/a,s.hasReduce="1";else if("4"==s.reduceM)a="10",e=Math.floor(s.count*a)/a,s.hasReduce="1";else if("5"==s.reduceM)a="10",e=Math.ceil(s.count*a)/a,s.hasReduce="1";else if("6"==s.reduceM)a="1",e=Math.floor(s.count*a)/a,s.hasReduce="1";else{if("7"!=s.reduceM)return;a="1",e=Math.ceil(s.count*a)/a,s.hasReduce="1"}s.reduceMoney=parseFloat(s.count)-parseFloat(e.toFixed(2)),s.reduceMoney=s.reduceMoney.toFixed(2),s.tdiscount=(parseFloat(s.reduceAmt)+parseFloat(s.reduceMoney)).toFixed(2),s.count=e.toFixed(2),s.countmong=s.count}},getDiscount:function(){var t=void 0;t=s.ulist.payType>=1?1:s.ulist.payType;var e={billId:s.ulist.billId,stmtId:s.ulist.stmtId,payType:t,payFeeType:s.payFeeType,regionName:s.ulist.regionname};s.axios.post("/getDiscounts",e).then(function(t){var e=JSON.parse(t.data);e.success?(s.discounts=e.result.reduction,s.totalPrice=e.result.total_fee_price,s.is_integral=e.result.is_enable_integral,s.integral=e.result.integral,"0"==s.is_integral?s.cullDiscount():s.Carandpay(s.totalPrice)):alert(e.message)})},cullDiscount:function(){for(var t=0,e=0;e<s.discounts.length;e++)t+=parseFloat(s.discounts[e].reduction_amt),s.discounts.length>1?(s.ruleType+=s.discounts[e].rule_type+",",s.reductionAmt+=s.discounts[e].reduction_amt+","):(s.ruleType=s.discounts[e].rule_type,s.reductionAmt=s.discounts[e].reduction_amt);s.discounts.length>1?s.reduceAmt=t:s.reductionAmt&&(s.reduceAmt=parseFloat(s.reductionAmt)),s.tdiscount=s.reduceAmt,s.count=(parseFloat(s.totalPrice)-parseFloat(s.reduceAmt)).toFixed(2),s.countmong=s.count,s.counttoll=s.count,s.Carandpay(s.count)},Coupons:function(){var t=void 0;t=s.ulist.payType>=1?1:s.ulist.payType;var e="getCouponsPayWuYe?payType="+t;s.receiveData.getData(s,e,"uptonDatas",function(){s.uptonData=s.uptonDatas.result,s.allCoupons=s.uptonDatas.result,s.filterCouponByAmount()})},filterCouponByAmount:function(){for(var t=[],e=0;e<s.allCoupons.length;e++)s.allCoupons[e].usageCondition<=s.count&&t.push(s.allCoupons[e]);s.uptonData=t},uptonList:function(){0!=s.uptonData.length&&"No"==s.sUptop&&(s.selectUpton=!1)},showIcon:function(t){if(s.uptonData[t].selected)s.$set(s.uptonData[t],"selected",!1),s.tdiscount=(parseFloat(s.tdiscount)-parseFloat(s.uptonData[t].amount)).toFixed(2);else{s.$set(s.uptonData[t],"selected",!0),s.tdiscount=(parseFloat(s.tdiscount)+parseFloat(s.uptonData[t].amount)).toFixed(2);for(var e in s.uptonData)if(e!=t&&1==s.uptonData[e].selected){s.$set(s.uptonData[e],"selected",!1),s.tdiscount=(parseFloat(s.tdiscount)-parseFloat(s.uptonData[e].amount)).toFixed(2);break}}},submit:function(){var t=!1;for(var e in s.uptonData)1==s.uptonData[e].selected&&(t=!0,s.couponId=s.uptonData[e].id,s.uptonAmount="-￥"+s.uptonData[e].amount+"元",s.upronAmountNumber=s.uptonData[e].amount,"0"==s.is_integral?s.count=s.countmong-s.uptonData[e].amount:"1"==s.reduceM||"2"==s.reduceM||"4"==s.reduceM||"5"==s.reduceM||"6"==s.reduceM||"7"==s.reduceM?s.count=s.countmong-s.uptonData[e].amount:s.count=s.totalPrice-s.uptonData[e].amount,s.count=s.count.toFixed(2),s.count<0&&(s.count=.01));t||(s.uptonAmount="未使用",s.upronAmountNumber=0,s.couponId="","0"==s.is_integral?s.Carandpay(s.counttoll):s.Carandpay(s.totalPrice)),s.selectUpton=!0},fixScroll:function(){!!navigator.userAgent.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/)&&setTimeout(function(){var t=document.documentElement.scrollTop||document.body.scrollTop||0;window.scrollTo(0,Math.max(t,0))},200)},getCaptcha:function(){s.sUptop="Locking","获取验证码"!=s.yzmstr&&"重新获取"!=s.yzmstr||(s.yzmstr="获取中",s.yzmreq())},yzmreq:function(){var t="/getPaySmsCode?cardId="+s.cardId;s.receiveData.getData(s,t,"res",function(){if(s.res.success){s.orderNo=s.res.result.orderNo,s.yzmtime=60,alert("验证码已下发，请查收短信");var t=setInterval(function(){s.yzmstr=s.yzmtime+"秒后重新获取",--s.yzmtime<=0&&(s.yzmstr="重新获取")},1e3);setTimeout(function(){clearInterval(t)},61e3)}else alert(null==s.res.message?"获取验证码失败":s.message)})},btnPay:function(){var e={};if(e=s.ulist,e.couponUnit=s.upronAmountNumber,e.couponId=s.couponId,e.reduceAmt=s.reduceMoney,e.ruleType=s.ruleType,e.reductionAmt=s.reductionAmt,e.payType>1&&""==s.captcha)return void alert("请输入验证码");s.showyan&&(e.veriCode=s.captcha,e.orderNo=s.orderNo,e.cardId=s.cardId),e.payType>1&&(e.payType="1"),t(".box-bg").css("display","block"),s.axios.post("getPrePayInfo",e).then(function(a){var n=JSON.parse(a.data);if(0==n.success)return alert(null==n.message?"支付失败":n.message),void t(".box-bg").css("display","none");if(0==e.payType)i.a.config({debug:!1,appId:n.result.appid,timestamp:n.result.timestamp,nonceStr:n.result.noncestr,signature:n.result.paysign,jsApiList:["chooseWXPay"]}),i.a.chooseWXPay({appId:n.result.appid,timestamp:n.result.timestamp,nonceStr:n.result.noncestr,package:n.result.package,signType:n.result.signtype,paySign:n.result.paysign,success:function(t){var e="noticePayed?tradeWaterId="+n.result.trade_water_id+"&feePrice="+s.totalPrice+"&bind_switch="+s.bind_switch;"未使用"!=s.uptonAmount&&(e+="&couponId="+s.couponId),s.receiveData.postData(s,e,{},"reqUrlData",function(){s.payInfo=s.reqUrlData.result;var t=s.common.getoriApp();window.location.href=s.basePageUrl+"wuye/index.html?"+t+"#/paymentquery"})},fail:function(t){},cancel:function(e){alert("支付取消"),t(".box-bg").css("display","none")}});else{var o=n.result.PAYURL;"SUCCESS"==n.result.pay_result&&s.$router.push({path:"/blank",query:{tradeWaterId:n.result.trade_water_id+"?"}}),o&&(window.location.href=o),t(".box-bg").css("display","none")}}).catch(function(t){})}},computed:{}}}).call(e,a("7t+N"))},MhFt:function(t,e,a){e=t.exports=a("FZ+f")(!1),e.push([t.i,"",""])},RCf6:function(t,e,a){"use strict";function s(t){a("A6Ag")}Object.defineProperty(e,"__esModule",{value:!0});var n=a("Aef7"),o=a("xWku"),i=a("VU/8"),u=s,c=i(n.a,o.a,!1,u,"data-v-0426f0b8",null);e.default=c.exports},xWku:function(t,e,a){"use strict";var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[t.selectUpton?a("div",[a("div",{staticClass:"box-bg"}),t._v(" "),a("div",{staticClass:"pay-div"},[a("span",{staticClass:"fl"},[t._v("支付方式")]),t._v(" "),a("span",{staticClass:"fr"},[t._v(t._s(t.typename))])]),t._v(" "),a("div",{staticClass:"pay-div"},[a("span",{staticClass:"fl"},[t._v("账单金额")]),t._v(" "),a("span",{staticClass:"fr padding-r"},[t._v("¥"+t._s(t.totalPrice))])]),t._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:"1"!=t.is_integral,expression:"is_integral != '1'"}]},[a("div",{directives:[{name:"show",rawName:"v-show",value:0!=t.discounts.length,expression:"discounts.length != 0"}]},[a("div",{staticClass:"pay-div margin-b"},[a("span",{directives:[{name:"show",rawName:"v-show",value:"01"==t.payFeeType,expression:"payFeeType == '01'"}],staticClass:"fl"},[t._v(t._s(t.disname))]),t._v(" "),a("span",{directives:[{name:"show",rawName:"v-show",value:"02"==t.payFeeType,expression:"payFeeType == '02'"}],staticClass:"fl"},[t._v(t._s(t.distname))]),t._v(" "),a("span",{directives:[{name:"show",rawName:"v-show",value:1==t.discounts.length,expression:"discounts.length == 1"}],staticClass:"fr Color padding-r"},[t._v("¥"+t._s(t.reduceAmt))])]),t._v(" "),a("ul",{directives:[{name:"show",rawName:"v-show",value:!(1==t.discounts.length),expression:"!(discounts.length == 1)"}],staticClass:"pd4"},t._l(t.discounts,function(e){return a("li",{staticClass:"ov mb2"},[a("span",{staticClass:"fl wcolor"},[t._v(t._s(e.reduction_msg))]),t._v(" "),a("span",{staticClass:"fr Color"},[t._v(t._s(e.reduction_amt))])])}))])]),t._v(" "),a("div",{staticClass:"pay-div",on:{click:t.uptonList}},[a("div",{staticClass:"fl"},[t._v("现金券\r\n                "),a("span",{staticClass:"can-use"},[t._v(" "),a("strong",[t._v(t._s(t.uptonData.length))]),t._v(" 张可用 ")])]),t._v(" "),a("span",{staticClass:"fr padding-r",class:{Color:"未使用"!=t.uptonAmount}},[t._v(t._s(t.uptonAmount)+" >")])]),t._v(" "),a("div",{staticClass:"pay-div Color"},[a("span",{staticClass:"fl"},[t._v("优惠总金额")]),t._v(" "),a("span",{staticClass:"fr padding-r"},[t._v("-¥"+t._s(t.tdiscount))])]),t._v(" "),a("div",{staticClass:"pay-div Color"},[a("span",{staticClass:"fl"},[t._v("支付金额")]),t._v(" "),a("span",{staticClass:"fr padding-r"},[t._v("¥"+t._s(t.count))])]),t._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:t.showyan,expression:"showyan"}],staticClass:"pay-div"},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.captcha,expression:"captcha"}],staticClass:"fl payinp",attrs:{type:"text",placeholder:"请输入验证码"},domProps:{value:t.captcha},on:{blur:t.fixScroll,input:function(e){e.target.composing||(t.captcha=e.target.value)}}}),t._v(" "),a("span",{staticClass:"fr btn-plain",class:{useless:"获取验证码"!=t.yzmstr&&"重新获取"!=t.yzmstr},on:{click:t.getCaptcha}},[t._v(t._s(t.yzmstr))])]),t._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:"1"==t.is_integral,expression:"is_integral == '1'"}],staticStyle:{padding:"0 0.3rem","letter-spacing":"1px"}},[t._v("本次支付您将获得"+t._s(t.integral)+"积分")]),t._v(" "),a("div",{staticStyle:{height:"1.5rem"}}),t._v(" "),a("div",{staticClass:"pay-btn",on:{click:t.btnPay}},[t._v("立即支付")])]):a("div",{staticClass:"upton-list"},[a("div",{staticClass:"can-use"},[a("p",{staticClass:"fl"},[t._v("可用现金券")]),t._v(" "),a("p",{staticClass:"fr"},[t._v("共"+t._s(t.uptonData.length)+"个")])]),t._v(" "),a("div",{staticClass:"updt"},t._l(t.uptonData,function(e,s){return a("div",{key:e.id,staticClass:"uptonDetail",on:{click:function(e){t.showIcon(s)}}},[a("i",{staticClass:"icon",class:{iconShow:e.selected}}),t._v(" "),a("div",{staticClass:"detail-left fl"},[a("div",{staticClass:"upton-name"},[t._v(t._s(e.title))]),t._v(" "),a("p",{staticClass:"validity"},[t._v(t._s(e.leftDayDes))]),t._v(" "),a("span",{staticClass:"text"},[t._v("使用期限 "+t._s(e.useStartDateStr)+"至"+t._s(e.useEndDateStr))])]),t._v(" "),a("div",{staticClass:"detail-right fr"},[a("p",{staticClass:"upton-number"},[t._v("￥"+t._s(e.amount))]),t._v(" "),a("p",{staticClass:"upton-type"},[t._v("现金券")])])])})),t._v(" "),a("div",{staticStyle:{width:"100%",height:"1.2rem"}}),t._v(" "),a("div",{staticClass:"btn",on:{click:t.submit}},[t._v("确定")])])])},n=[],o={render:s,staticRenderFns:n};e.a=o}});